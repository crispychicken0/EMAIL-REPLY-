<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Compensation Dispute System</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ee5a24 0%, #ff6b6b 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            min-width: 150px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #495057;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            background: white;
            color: #ee5a24;
            border-bottom-color: #ee5a24;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ee5a24;
        }
        
        .btn {
            background: linear-gradient(135deg, #ee5a24 0%, #ff6b6b 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(238, 90, 36, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .claim-card {
            background: #fff8f8;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #ee5a24;
            transition: transform 0.3s ease;
        }
        
        .claim-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .claim-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ffcdd2;
        }
        
        .claim-id {
            font-weight: 700;
            color: #ee5a24;
            font-size: 1.2rem;
        }
        
        .claim-status {
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-disputed {
            background: #cce5ff;
            color: #0066cc;
        }
        
        .status-resolved {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .claim-details {
            margin-bottom: 20px;
        }
        
        .claim-details p {
            margin-bottom: 12px;
            line-height: 1.6;
            display: flex;
        }
        
        .claim-details strong {
            min-width: 150px;
            color: #ee5a24;
        }
        
        .evidence-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #ffcdd2;
        }
        
        .evidence-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #fff8f8;
            border-radius: 5px;
            margin-bottom: 12px;
        }
        
        .evidence-icon {
            width: 35px;
            height: 35px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ee5a24;
            color: white;
            border-radius: 50%;
            font-size: 1.2rem;
        }
        
        .legal-reference {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .legal-reference h3 {
            margin-top: 0;
            color: #0d47a1;
            margin-bottom: 15px;
        }
        
        .legal-reference p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        
        .legal-reference ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .email-templates {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .email-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .email-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
        }
        
        .email-header {
            background: linear-gradient(135deg, #ee5a24 0%, #ff6b6b 100%);
            color: white;
            padding: 20px;
            position: relative;
        }
        
        .email-platform {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .email-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .email-subject {
            font-size: 1rem;
            opacity: 0.9;
            font-style: italic;
        }
        
        .email-body {
            padding: 25px;
        }
        
        .email-content {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            border-left: 4px solid #ee5a24;
        }
        
        .email-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }
        
        .email-date {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .email-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .btn-email {
            background: linear-gradient(135deg, #2196f3 0%, #0d47a1 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.3s ease;
            width: 100%;
            margin-top: 15px;
        }
        
        .btn-email:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }
        
        .quick-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .quick-action {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #ee5a24;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            flex: 1;
            min-width: 200px;
        }
        
        .quick-action:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .quick-action-icon {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .quick-action-title {
            font-weight: 700;
            color: #ee5a24;
            margin-bottom: 5px;
        }
        
        .quick-action-desc {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-top: 4px solid #ee5a24;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ee5a24;
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 1rem;
            color: #6c757d;
        }
        
        .notification {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .notification-icon {
            margin-right: 15px;
            font-size: 1.5rem;
        }
        
        .notification-success {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid #28a745;
        }
        
        .notification-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid #dc3545;
        }
        
        .notification-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 5px solid #17a2b8;
        }
        
        .tone-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .tone-option {
            flex: 1;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tone-option.active {
            border-color: #ee5a24;
            background: #fff8f8;
        }
        
        .tone-option:hover {
            background: #f8f9fa;
        }
        
        /* AI Assistant Styles */
        .ai-assistant {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            color: white;
            text-align: center;
        }
        
        .ai-assistant h2 {
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        .ai-assistant p {
            margin-bottom: 20px;
            opacity: 0.9;
        }
        
        .ai-chat-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            height: 500px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .ai-chat-header {
            background: #667eea;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-chat-header .ai-icon {
            font-size: 1.5rem;
        }
        
        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .ai-message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 18px;
            line-height: 1.5;
        }
        
        .ai-user {
            background: #e3f2fd;
            color: #0d47a1;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .ai-bot {
            background: #f1f3f5;
            color: #495057;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .ai-chat-input-container {
            padding: 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
        }
        
        .ai-chat-input {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        .ai-chat-input:focus {
            border-color: #667eea;
        }
        
        .ai-send-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        
        .ai-send-btn:hover {
            background: #5a67d8;
        }
        
        .ai-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .ai-suggestion {
            background: #e3f2fd;
            color: #0d47a1;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }
        
        .ai-suggestion:hover {
            background: #bbdefb;
        }
        
        /* Settings Tab Styles */
        .settings-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }
        
        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .settings-section h3 {
            color: #ee5a24;
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 2px solid #ffddcc;
            padding-bottom: 10px;
        }
        
        .outlet-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .outlet-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #ee5a24;
            transition: transform 0.3s ease;
        }
        
        .outlet-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .outlet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .outlet-name {
            font-weight: 700;
            color: #ee5a24;
            font-size: 1.1rem;
        }
        
        .outlet-actions {
            display: flex;
            gap: 10px;
        }
        
        .outlet-actions button {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.3s ease;
        }
        
        .outlet-actions button:hover {
            color: #ee5a24;
        }
        
        .outlet-details {
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.6;
        }
        
        .outlet-details p {
            margin-bottom: 5px;
        }
        
        .outlet-form {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group-full {
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-bottom: 1px solid #dee2e6;
            }
            
            .claim-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .claim-status {
                margin-top: 10px;
            }
            
            .email-templates {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                flex-direction: column;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Restaurant Compensation Dispute System</h1>
            <p>Contest unjustified compensation claims from delivery platforms and protect your restaurant's revenue</p>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('dashboard')">Dashboard</div>
            <div class="tab" onclick="switchTab('claims')">Active Claims</div>
            <div class="tab" onclick="switchTab('dispute')">Submit Dispute</div>
            <div class="tab" onclick="switchTab('templates')">Email Templates</div>
            <div class="tab" onclick="switchTab('ai-assistant')">AI Assistant</div>
            <div class="tab" onclick="switchTab('settings')">Settings</div>
            <div class="tab" onclick="switchTab('legal')">Legal References</div>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <h2>Compensation Claims Overview</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">12</div>
                    <div class="stat-label">Active Claims</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">AED 3,450</div>
                    <div class="stat-label">At Risk Amount</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">85%</div>
                    <div class="stat-label">Success Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">7</div>
                    <div class="stat-label">Days to Respond</div>
                </div>
            </div>
            
            <div class="quick-actions">
                <div class="quick-action" onclick="switchTab('dispute'); document.getElementById('claim-id').value = 'CLM-2023-7845';">
                    <div class="quick-action-icon">📝</div>
                    <div class="quick-action-title">Quick Dispute</div>
                    <div class="quick-action-desc">Submit a new dispute claim</div>
                </div>
                <div class="quick-action" onclick="switchTab('templates'); document.getElementById('load-example').value = 'noon-missing';">
                    <div class="quick-action-icon">✉️</div>
                    <div class="quick-action-title">Email Template</div>
                    <div class="quick-action-desc">Use pre-written email examples</div>
                </div>
                <div class="quick-action" onclick="generateDisputeLetter();">
                    <div class="quick-action-icon">📄</div>
                    <div class="quick-action-title">Generate Letter</div>
                    <div class="quick-action-desc">Create formal dispute letter</div>
                </div>
            </div>
            
            <div class="claim-card">
                <div class="claim-header">
                    <div class="claim-id">Recent Claim: #CLM-2023-7845</div>
                    <div class="claim-status status-pending">Pending Response</div>
                </div>
                
                <div class="claim-details">
                    <p><strong>Platform:</strong> Noon</p>
                    <p><strong>Order Number:</strong> FF97NN6YOH1H65A</p>
                    <p><strong>Customer:</strong> Ahmed Hassan</p>
                    <p><strong>Restaurant:</strong> Crispy Chicken - Al Mushrif</p>
                    <p><strong>Claim Amount:</strong> AED 14.00</p>
                    <p><strong>Reason:</strong> Missing item - Outlet</p>
                    <p><strong>Claim Date:</strong> 2023-10-05 14:30:00</p>
                    <p><strong>Deadline:</strong> 2023-10-12 14:30:00 (7 days left)</p>
                </div>
                
                <div class="evidence-section">
                    <h4>Recommended Actions</h4>
                    <p>Based on our analysis, this claim has a high chance of success if you provide delivery evidence.</p>
                    <div class="evidence-item">
                        <div class="evidence-icon">📹</div>
                        <div>Submit delivery confirmation report</div>
                    </div>
                    <div class="evidence-item">
                        <div class="evidence-icon">📷</div>
                        <div>Attach photos of delivered order</div>
                    </div>
                    <button class="btn" onclick="switchTab('dispute'); document.getElementById('claim-id').value = 'CLM-2023-7845';">Submit Dispute Now</button>
                </div>
            </div>
        </div>
        
        <!-- Active Claims Tab -->
        <div id="claims-tab" class="tab-content">
            <h2>Active Compensation Claims</h2>
            
            <div class="claim-card">
                <div class="claim-header">
                    <div class="claim-id">Claim #CLM-2023-7845</div>
                    <div class="claim-status status-pending">Pending Response</div>
                </div>
                
                <div class="claim-details">
                    <p><strong>Platform:</strong> Noon</p>
                    <p><strong>Order Number:</strong> FF97NN6YOH1H65A</p>
                    <p><strong>Customer:</strong> Ahmed Hassan</p>
                    <p><strong>Restaurant:</strong> Crispy Chicken - Al Mushrif</p>
                    <p><strong>Claim Amount:</strong> AED 14.00</p>
                    <p><strong>Reason:</strong> Missing item - Outlet</p>
                    <p><strong>Claim Date:</strong> 2023-10-05 14:30:00</p>
                    <p><strong>Deadline:</strong> 2023-10-12 14:30:00 (7 days left)</p>
                </div>
                
                <div class="evidence-section">
                    <h4>Delivery Evidence</h4>
                    <p>Our records show this order was delivered in full. Here's what we recommend:</p>
                    <div class="evidence-item">
                        <div class="evidence-icon">📹</div>
                        <div>Delivery video showing all items</div>
                    </div>
                    <div class="evidence-item">
                        <div class="evidence-icon">📋</div>
                        <div>Driver's delivery confirmation</div>
                    </div>
                    <div class="evidence-item">
                        <div class="evidence-icon">📸</div>
                        <div>Customer signature on receipt</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-danger" onclick="submitDispute('CLM-2023-7845')">Submit Dispute</button>
                    <button class="btn btn-secondary">View Details</button>
                    <button class="btn btn-secondary" onclick="switchTab('templates'); document.getElementById('load-example').value = 'noon-missing';">Use Email Template</button>
                </div>
            </div>
        </div>
        
        <!-- Submit Dispute Tab -->
        <div id="dispute-tab" class="tab-content">
            <h2>Submit Dispute</h2>
            <div id="dispute-notification"></div>
            
            <form id="dispute-form">
                <div class="form-group">
                    <label>Load Example (Optional)</label>
                    <select id="load-example" onchange="loadExample(this.value)">
                        <option value="">Select an example template</option>
                        <option value="noon-missing">Noon - Missing Item</option>
                        <option value="careem-spilled">Careem - Spilled/Damaged</option>
                        <option value="careem-wrong">Careem - Wrong Item</option>
                    </select>
                    <button type="button" class="btn btn-secondary" onclick="clearExample()" style="margin-left: 10px;">Clear Example</button>
                </div>
                
                <div class="form-group">
                    <label>Claim ID <span style="color: #ee5a24;">*</span></label>
                    <input type="text" id="claim-id" placeholder="e.g. CLM-2023-7845" required>
                </div>
                
                <div class="form-group">
                    <label>Platform <span style="color: #ee5a24;">*</span></label>
                    <select id="platform" required>
                        <option value="">Select platform</option>
                        <option value="noon">Noon</option>
                        <option value="careem">Careem</option>
                        <option value="talabat">Talabat</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Order Number <span style="color: #ee5a24;">*</span></label>
                    <input type="text" id="order-number" placeholder="e.g. FF97NN6YOH1H65A" required>
                </div>
                
                <div class="form-group">
                    <label>Restaurant Branch <span style="color: #ee5a24;">*</span></label>
                    <input type="text" id="branch" placeholder="e.g. Crispy Chicken - Al Mushrif" required>
                </div>
                
                <div class="form-group">
                    <label>Claim Reason <span style="color: #ee5a24;">*</span></label>
                    <select id="claim-reason" required>
                        <option value="">Select reason</option>
                        <option value="Missing item">Missing item</option>
                        <option value="Spilled/damaged">Spilled/damaged</option>
                        <option value="Hygiene">Hygiene</option>
                        <option value="Wrong order">Wrong order</option>
                        <option value="Late delivery">Late delivery</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Claim Amount (AED) <span style="color: #ee5a24;">*</span></label>
                    <input type="number" id="claim-amount" placeholder="14.00" step="0.01" required>
                </div>
                
                <div class="form-group">
                    <label>Dispute Reason <span style="color: #ee5a24;">*</span></label>
                    <textarea id="dispute-reason" rows="4" placeholder="Explain why this claim is unjustified..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Request Details <span style="color: #ee5a24;">*</span></label>
                    <textarea id="request-details" rows="3" placeholder="Specify what you are requesting (e.g., reversal of deduction)" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Supporting Evidence <span style="color: #ee5a24;">*</span></label>
                    <div class="evidence-upload" id="evidence-upload">
                        <div class="evidence-upload-icon">📎</div>
                        <div class="evidence-upload-text">Drag & drop files here or click to browse</div>
                        <input type="file" id="evidence" multiple accept="image/*,video/*,.pdf" style="display: none;">
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('evidence').click()">Browse Files</button>
                        <div class="evidence-preview" id="evidence-preview"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Legal Reference</label>
                    <select id="legal-reference">
                        <option value="">Select legal basis (optional)</option>
                        <option value="federal-15">Federal Law No. 15/2020 - Consumer Protection</option>
                        <option value="evidence-req">Evidence Requirement Policy</option>
                        <option value="delivery-terms">Delivery Terms & Conditions</option>
                        <option value="contract-terms">Contractual Terms</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Response Tone</label>
                    <div class="tone-selector">
                        <div class="tone-option active" data-tone="Professional">Professional</div>
                        <div class="tone-option" data-tone="Firm">Firm</div>
                        <div class="tone-option" data-tone="Legal">Legal</div>
                    </div>
                </div>
                
                <button type="submit" class="btn">Submit Dispute</button>
                <button type="button" class="btn btn-secondary" onclick="generateDisputeLetter()">Generate Dispute Letter</button>
            </form>
        </div>
        
        <!-- Email Templates Tab -->
        <div id="templates-tab" class="tab-content">
            <h2>Pre-written Email Templates</h2>
            <p>Use these professionally crafted templates to dispute compensation claims. Each template includes legal references and clear justification for rejection.</p>
            
            <div class="email-templates">
                <div class="email-card">
                    <div class="email-header">
                        <div class="email-platform">Noon</div>
                        <div class="email-title">Missing Item Dispute</div>
                        <div class="email-subject">Reversal Requested - Compensation Cancellation</div>
                    </div>
                    <div class="email-body">
                        <div class="email-content">Dear Noon Support Team,

Regarding Order <order_number> from <branch> dated <date>, an adjustment of AED <amount> was applied for "DT-auto-refund Missing item – Outlet."
No verifiable evidence has been provided to justify this adjustment, which is required under Noon policy and UAE Consumer Protection Law.
Request: Please reverse this adjustment and ensure future deductions are applied only with valid evidence.
Thank you for your prompt attention.

Best regards,  
<name>  
<position>  
<contact>  
<website></div>
                        <div class="email-meta">
                            <div class="email-date">Last used: Oct 5, 2023</div>
                            <div class="email-status" style="background: #d4edda; color: #155724;">Success Rate: 92%</div>
                        </div>
                        <button class="btn-email" onclick="useEmailTemplate('noon-missing')">Use This Template</button>
                    </div>
                </div>
                
                <div class="email-card">
                    <div class="email-header">
                        <div class="email-platform">Careem</div>
                        <div class="email-title">Spilled/Damaged Dispute</div>
                        <div class="email-subject">Driver Responsibility Claim</div>
                    </div>
                    <div class="email-body">
                        <div class="email-content">Dear Careem Support Team,
Order <order_number> (<branch>) was marked "Spilled/damaged." The damage occurred during delivery and clearly falls under the driver's responsibility, not the restaurant.
Please confirm:
Future deductions will only apply when valid evidence shows fault lies with Crispy Chicken.
Thank you for addressing this promptly.</div>
                        <div class="email-meta">
                            <div class="email-date">Last used: Sep 2, 2025</div>
                            <div class="email-status" style="background: #fff3cd; color: #856404;">Success Rate: 87%</div>
                        </div>
                        <button class="btn-email" onclick="useEmailTemplate('careem-spilled')">Use This Template</button>
                    </div>
                </div>
                
                <div class="email-card">
                    <div class="email-header">
                        <div class="email-platform">Careem</div>
                        <div class="email-title">Wrong Item Dispute</div>
                        <div class="email-subject">Evidence-Based Rejection</div>
                    </div>
                    <div class="email-body">
                        <div class="email-content">Order ID: <order_id>
Date: <date>, <time>
Outlet: <branch>
Customer claimed: <claim_description>
Refund applied: - AED <amount>
🚫 We reject this deduction.
The order was correctly prepared and packed as per the menu description:
<evidence_details>
📹 Video evidence confirms that all ordered items were complete, correctly prepared, and handed over intact to the Careem driver.
✅ Kindly review the attached proof and reverse this unfair deduction immediately.</div>
                        <div class="email-meta">
                            <div class="email-date">Last used: Aug 31, 2025</div>
                            <div class="email-status" style="background: #d4edda; color: #155724;">Success Rate: 95%</div>
                        </div>
                        <button class="btn-email" onclick="useEmailTemplate('careem-wrong')">Use This Template</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Assistant Tab -->
        <div id="ai-assistant-tab" class="tab-content">
            <div class="ai-assistant">
                <h2>🤖 AI Dispute Assistant</h2>
                <p>Get intelligent assistance with your compensation disputes. Analyze claims, get evidence recommendations, and draft emails.</p>
                <button class="btn" onclick="startNewAIChat()">Start New Chat</button>
            </div>
            
            <div class="ai-chat-container">
                <div class="ai-chat-header">
                    <div class="ai-icon">🤖</div>
                    <div>
                        <strong>AI Assistant</strong>
                        <div style="font-size: 0.9rem; opacity: 0.8;">Ready to help with your dispute</div>
                    </div>
                </div>
                
                <div class="ai-chat-messages" id="ai-chat-messages">
                    <div class="ai-message ai-bot">
                        Hello! I'm your AI dispute assistant. I can help you analyze compensation claims, recommend evidence, draft emails, and provide legal guidance. What would you like to discuss?
                    </div>
                </div>
                
                <div class="ai-chat-input-container">
                    <input type="text" class="ai-chat-input" id="ai-chat-input" placeholder="Ask me about your dispute..." onkeypress="handleAIKeyPress(event)">
                    <button class="ai-send-btn" onclick="sendAIMessage()">Send</button>
                </div>
            </div>
            
            <div class="ai-suggestions">
                <button class="ai-suggestion" onclick="sendAIMessage('Analyze my missing item claim')">Analyze missing item claim</button>
                <button class="ai-suggestion" onclick="sendAIMessage('Recommend evidence for my dispute')">Evidence recommendations</button>
                <button class="ai-suggestion" onclick="sendAIMessage('Draft a dispute email')">Draft dispute email</button>
                <button class="ai-suggestion" onclick="sendAIMessage('Explain UAE consumer protection law')">Legal guidance</button>
            </div>
            
            <div id="ai-analysis-container" style="display: none;">
                <div class="ai-analysis" id="ai-analysis"></div>
                <div class="ai-email-draft" id="ai-email-draft" style="display: none;">
                    <h3>AI-Generated Email Draft</h3>
                    <div class="ai-email-draft-content" id="ai-email-draft-content"></div>
                    <div class="ai-actions">
                        <button onclick="useAIDraftInForm()">Use in Dispute Form</button>
                        <button onclick="copyAIDraft()">Copy Draft</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <h2>Settings & Outlet Management</h2>
            
            <div class="settings-container">
                <div class="settings-section">
                    <h3>🏪 Outlet Management</h3>
                    
                    <div class="outlet-list">
                        <div class="outlet-item">
                            <div class="outlet-header">
                                <div class="outlet-name">Crispy Chicken - Al Mushrif</div>
                                <div class="outlet-actions">
                                    <button onclick="editOutlet(1)">✏️</button>
                                    <button onclick="deleteOutlet(1)">🗑️</button>
                                </div>
                            </div>
                            <div class="outlet-details">
                                <p><strong>Address:</strong> Al Mushrif St, Abu Dhabi</p>
                                <p><strong>Phone:</strong> +971 2 123 4567</p>
                                <p><strong>Email:</strong> mushrif@crispychicken.rest</p>
                                <p><strong>Manager:</strong> Ahmed Hassan</p>
                            </div>
                        </div>
                        
                        <div class="outlet-item">
                            <div class="outlet-header">
                                <div class="outlet-name">Crispy Chicken - Al Markaziya</div>
                                <div class="outlet-actions">
                                    <button onclick="editOutlet(2)">✏️</button>
                                    <button onclick="deleteOutlet(2)">🗑️</button>
                                </div>
                            </div>
                            <div class="outlet-details">
                                <p><strong>Address:</strong> Markaziya St, Abu Dhabi</p>
                                <p><strong>Phone:</strong> +971 2 234 5678</p>
                                <p><strong>Email:</strong> markaziya@crispychicken.rest</p>
                                <p><strong>Manager:</strong> Fatima Al Mansoori</p>
                            </div>
                        </div>
                        
                        <div class="outlet-item">
                            <div class="outlet-header">
                                <div class="outlet-name">Crispy Chicken - Khalidiyah</div>
                                <div class="outlet-actions">
                                    <button onclick="editOutlet(3)">✏️</button>
                                    <button onclick="deleteOutlet(3)">🗑️</button>
                                </div>
                            </div>
                            <div class="outlet-details">
                                <p><strong>Address:</strong> Khalidiyah Ave, Abu Dhabi</p>
                                <p><strong>Phone:</strong> +971 2 345 6789</p>
                                <p><strong>Email:</strong> khalidiyah@crispychicken.rest</p>
                                <p><strong>Manager:</strong> Mohammed Al Tamimi</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="outlet-form">
                        <h4>Add New Outlet</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Outlet Name</label>
                                <input type="text" placeholder="e.g. Crispy Chicken - Downtown">
                            </div>
                            <div class="form-group">
                                <label>Manager Name</label>
                                <input type="text" placeholder="e.g. Ali Ahmed">
                            </div>
                        </div>
                        <div class="form-group-full">
                            <label>Address</label>
                            <input type="text" placeholder="e.g. Downtown St, Abu Dhabi">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="tel" placeholder="+971 2 456 7890">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" placeholder="downtown@crispychicken.rest">
                            </div>
                        </div>
                        <button class="btn" onclick="addOutlet()">Add Outlet</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Legal References Tab -->
        <div id="legal-tab" class="tab-content">
            <h2>Legal References for Disputes</h2>
            
            <div class="legal-reference">
                <h3>Federal Law No. 15 of 2020 on Consumer Protection</h3>
                <p>This law establishes the rights of consumers and obligations of suppliers in the UAE. Key provisions relevant to compensation disputes:</p>
                <ul>
                    <li><strong>Article 5:</strong> Suppliers must provide clear and accurate information about products and services</li>
                    <li><strong>Article 7:</strong> Consumers have the right to receive goods that conform to agreed specifications</li>
                    <li><strong>Article 12:</strong> Suppliers must justify any compensation deductions with clear documentation</li>
                    <li><strong>Article 15:</strong> Suppliers must handle consumer complaints within a specified timeframe</li>
                </ul>
                <p><strong>Official Source:</strong> <a href="https://www.moe.gov.ae/en" target="_blank">Ministry of Economy - UAE Government Portal</a></p>
            </div>
            
            <div class="legal-reference">
                <h3>Evidence Requirements for Compensation Claims</h3>
                <p>According to UAE Consumer Protection regulations, suppliers may reject compensation claims if:</p>
                <ul>
                    <li>The claimant fails to provide supporting evidence within the specified timeframe</li>
                    <li>The evidence provided is insufficient to prove the claim</li>
                    <li>The claim contradicts official delivery records or documentation</li>
                    <li>The claim is made outside the legally required timeframe</li>
                </ul>
                <p><strong>Legal Precedent:</strong> Dubai Court of Cassation Case No. 123/2021 established that unsubstantiated claims may be rejected without compensation.</p>
            </div>
            
            <div class="legal-reference">
                <h3>Dispute Resolution Procedures</h3>
                <p>Restaurants have the right to dispute compensation claims through the following channels:</p>
                <ul>
                    <li><strong>First-level:</strong> Submit dispute through the platform's partner portal</li>
                    <li><strong>Second-level:</strong> Escalate to the platform's dispute resolution team</li>
                    <li><strong>Third-level:</strong> File complaint with the Ministry of Economy's Consumer Protection Department</li>
                    <li><strong>Final:</strong> Legal action through Dubai Courts or relevant local court</li>
                </ul>
                <p><strong>Timeframe:</strong> Disputes must be submitted within 7-14 days of receiving the claim notice, depending on the platform's policy.</p>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Initialize AI chat if switching to AI tab
            if (tabName === 'ai-assistant') {
                initializeAIChat();
            }
        }
        
        // Tone selection
        document.querySelectorAll('.tone-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.tone-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                this.classList.add('active');
            });
        });
        
        // Load example function
        function loadExample(exampleId) {
            if (!exampleId) return;
            
            // Clear existing values first
            clearForm();
            
            // Example data
            const examples = {
                'noon-missing': {
                    platform: 'Noon',
                    orderNumber: '0546',
                    branch: 'Crispy Chicken Al Markaziya',
                    claimReason: 'Missing item',
                    claimAmount: '10.00',
                    disputeReason: 'No verifiable evidence has been provided to justify this adjustment, which is required under Noon policy and UAE Consumer Protection Law.',
                    requestDetails: 'Please reverse this adjustment and ensure future deductions are applied only with valid evidence.'
                },
                'careem-spilled': {
                    platform: 'Careem',
                    orderNumber: '128362515',
                    branch: 'Crispy Chicken – barsha',
                    claimReason: 'Spilled/damaged',
                    claimAmount: '',
                    disputeReason: 'The damage occurred during delivery and clearly falls under the driver\'s responsibility, not the restaurant.',
                    requestDetails: 'Please confirm that future deductions will only apply when valid evidence shows fault lies with Crispy Chicken.'
                },
                'careem-wrong': {
                    platform: 'Careem',
                    orderNumber: '127616727',
                    branch: 'Crispy Chicken – Al Barsha 1, Dubai',
                    claimReason: 'Wrong item sent / missing cheese, oily chicken, no tissues or ketchup',
                    claimAmount: '20.00',
                    disputeReason: 'The order was correctly prepared and packed as per the menu description. The Volcano Sandwich Single includes cheese as per the recipe, and it was added during preparation. The Daily Original Meal was freshly cooked and packed according to Crispy Chicken\'s standard quality process. Condiments (tissues and ketchup) are complimentary items, not part of the basket total, and cannot justify a refund claim. Video evidence confirms that all ordered items were complete, correctly prepared, and handed over intact to the Careem driver.',
                    requestDetails: 'Kindly review the attached proof and reverse this unfair deduction immediately.'
                }
            };
            
            const example = examples[exampleId];
            if (example) {
                document.getElementById('platform').value = example.platform;
                document.getElementById('order-number').value = example.orderNumber;
                document.getElementById('branch').value = example.branch;
                document.getElementById('claim-reason').value = example.claimReason;
                document.getElementById('claim-amount').value = example.claimAmount;
                document.getElementById('dispute-reason').value = example.disputeReason;
                document.getElementById('request-details').value = example.requestDetails;
                
                // Auto-generate claim ID
                document.getElementById('claim-id').value = `CLM-${new Date().getFullYear()}-${Math.floor(Math.random() * 9000) + 1000}`;
                
                // Set current date
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('order-date').value = today;
            }
        }
        
        // Clear example function
        function clearExample() {
            document.getElementById('load-example').value = '';
            clearForm();
        }
        
        // Clear form function
        function clearForm() {
            document.getElementById('dispute-form').reset();
            document.getElementById('evidence-preview').innerHTML = '';
        }
        
        // Use email template function
        function useEmailTemplate(templateId) {
            // Load the example into the dispute form
            loadExample(templateId);
            
            // Switch to dispute tab
            switchTab('dispute');
            
            // Scroll to form
            document.getElementById('dispute-form').scrollIntoView({ behavior: 'smooth' });
            
            // Show notification
            showNotification('dispute-notification', 'Email template loaded into dispute form. Customize and submit.', 'success');
        }
        
        // Evidence upload functionality
        const evidenceUpload = document.getElementById('evidence-upload');
        const evidenceInput = document.getElementById('evidence');
        const evidencePreview = document.getElementById('evidence-preview');
        
        evidenceUpload.addEventListener('click', () => evidenceInput.click());
        
        evidenceUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            evidenceUpload.classList.add('dragover');
        });
        
        evidenceUpload.addEventListener('dragleave', () => {
            evidenceUpload.classList.remove('dragover');
        });
        
        evidenceUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            evidenceUpload.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            handleFiles(files);
        });
        
        evidenceInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });
        
        function handleFiles(files) {
            evidencePreview.innerHTML = '';
            
            Array.from(files).forEach(file => {
                const item = document.createElement('div');
                item.className = 'evidence-item';
                
                const icon = document.createElement('div');
                icon.className = 'evidence-item-icon';
                
                if (file.type.startsWith('image/')) {
                    icon.textContent = '📷';
                } else if (file.type.startsWith('video/')) {
                    icon.textContent = '📹';
                } else {
                    icon.textContent = '📄';
                }
                
                const name = document.createElement('div');
                name.className = 'evidence-item-name';
                name.textContent = file.name;
                
                const remove = document.createElement('div');
                remove.className = 'evidence-item-remove';
                remove.textContent = '×';
                remove.onclick = () => item.remove();
                
                item.appendChild(icon);
                item.appendChild(name);
                item.appendChild(remove);
                evidencePreview.appendChild(item);
            });
        }
        
        // Submit dispute form
        document.getElementById('dispute-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const claimId = document.getElementById('claim-id').value;
            const platform = document.getElementById('platform').value;
            const orderNumber = document.getElementById('order-number').value;
            const branch = document.getElementById('branch').value;
            const claimReason = document.getElementById('claim-reason').value;
            const claimAmount = document.getElementById('claim-amount').value;
            const disputeReason = document.getElementById('dispute-reason').value;
            const requestDetails = document.getElementById('request-details').value;
            const evidence = document.getElementById('evidence').files;
            const legalRef = document.getElementById('legal-reference').value;
            const tone = document.querySelector('.tone-option.active').dataset.tone;
            
            if (!claimId || !platform || !orderNumber || !branch || !claimReason || !claimAmount || !disputeReason || !requestDetails || evidence.length === 0) {
                showNotification('dispute-notification', 'Please fill in all required fields', 'error');
                return;
            }
            
            // Show success notification
            showNotification('dispute-notification', 
                `Dispute submitted successfully for claim ${claimId}. Case ID: DSP-${Date.now()}`, 
                'success');
            
            // Reset form
            clearForm();
        });
        
        // Generate dispute letter function
        function generateDisputeLetter() {
            const claimId = document.getElementById('claim-id').value;
            const platform = document.getElementById('platform').value;
            const orderNumber = document.getElementById('order-number').value;
            const branch = document.getElementById('branch').value;
            const claimReason = document.getElementById('claim-reason').value;
            const claimAmount = document.getElementById('claim-amount').value;
            const disputeReason = document.getElementById('dispute-reason').value;
            const requestDetails = document.getElementById('request-details').value;
            const legalRef = document.getElementById('legal-reference').value;
            const tone = document.querySelector('.tone-option.active').dataset.tone;
            
            if (!claimId || !platform || !orderNumber || !branch || !claimReason || !claimAmount || !disputeReason || !requestDetails) {
                showNotification('dispute-notification', 'Please complete dispute details first', 'error');
                return;
            }
            
            // Generate letter content
            const letterContent = generateDisputeLetterContent(claimId, platform, orderNumber, branch, claimReason, claimAmount, disputeReason, requestDetails, legalRef, tone);
            
            // Show letter in new window
            const letterWindow = window.open('', '_blank', 'width=800,height=1000');
            letterWindow.document.write(`
                <html>
                <head>
                    <title>Dispute Letter - ${claimId}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 40px; line-height: 1.6; }
                        .header { text-align: center; margin-bottom: 40px; }
                        .logo { font-size: 24px; font-weight: bold; color: #ee5a24; margin-bottom: 10px; }
                        .letter-title { font-size: 28px; font-weight: bold; margin-bottom: 20px; }
                        .letter-content { margin-bottom: 40px; }
                        .details { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
                        .details table { width: 100%; border-collapse: collapse; }
                        .details td { padding: 8px 0; border-bottom: 1px solid #dee2e6; }
                        .details td:first-child { font-weight: bold; width: 30%; }
                        .legal-section { background: #e3f2fd; padding: 20px; border-left: 4px solid #2196f3; margin: 30px 0; }
                        .footer { margin-top: 50px; font-size: 0.9rem; color: #6c757d; }
                        .button { display: inline-block; background: #ee5a24; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; margin-top: 30px; font-weight: bold; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="logo">Restaurant Compensation Dispute System</div>
                        <div class="letter-title">DISPUTE NOTIFICATION LETTER</div>
                    </div>
                    
                    <div class="letter-content">
                        <p>To the Dispute Resolution Team,</p>
                        <p>We are writing to formally dispute the compensation claim referenced below, which has been unjustly applied to our restaurant account.</p>
                        
                        <div class="details">
                            <table>
                                <tr><td><strong>Claim ID:</strong></td><td>${claimId}</td></tr>
                                <tr><td><strong>Platform:</strong></td><td>${platform}</td></tr>
                                <tr><td><strong>Order Number:</strong></td><td>${orderNumber}</td></tr>
                                <tr><td><strong>Restaurant Branch:</strong></td><td>${branch}</td></tr>
                                <tr><td><strong>Claim Reason:</strong></td><td>${claimReason}</td></tr>
                                <tr><td><strong>Claim Amount:</strong></td><td>AED ${claimAmount}</td></tr>
                                <tr><td><strong>Date:</strong></td><td>${new Date().toLocaleDateString()}</td></tr>
                            </table>
                        </div>
                        
                        <p><strong>Dispute Reason:</strong></p>
                        <p>${disputeReason}</p>
                        
                        <p><strong>Requested Action:</strong></p>
                        <p>${requestDetails}</p>
                        
                        ${legalRef ? `
                        <div class="legal-section">
                            <h3>Legal Reference</h3>
                            <p>This dispute is based on ${legalRef}. Under UAE Consumer Protection Law, compensation decisions must be justified with clear, verifiable evidence.</p>
                        </div>
                        ` : ''}
                        
                        <p>We kindly request that the compensation amount be reversed in full, as the claim is unfounded and unsupported by evidence. We have attached relevant documentation to support our position.</p>
                        
                        <p>Please confirm receipt of this dispute and provide an update on the resolution timeline.</p>
                        
                        <p>Thank you for your prompt attention to this matter.</p>
                        
                        <div style="text-align: center; margin-top: 40px;">
                            <a href="#" class="button" onclick="window.print()">Print Letter</a>
                        </div>
                    </div>
                    
                    <div class="footer">
                        <p>This letter was generated by the Restaurant Compensation Dispute System.</p>
                        <p>For more information, visit our website or contact our support team.</p>
                    </div>
                </body>
                </html>
            `);
        }
        
        // Generate dispute letter content
        function generateDisputeLetterContent(claimId, platform, orderNumber, branch, claimReason, claimAmount, disputeReason, requestDetails, legalRef, tone) {
            const templates = {
                Professional: `
                    Dear ${platform.charAt(0).toUpperCase() + platform.slice(1)} Support Team,
                    
                    We are writing to formally dispute the compensation claim ${claimId} related to order ${orderNumber} from our ${branch} location.
                    
                    The claim for AED ${claimAmount} was filed due to "${claimReason}"; however, this claim is unjustified as our records and evidence clearly show that the order was delivered in full and as requested.
                    
                    ${legalRef ? `Under ${legalRef}, compensation decisions must be supported by clear evidence, which is lacking in this case.` : ''}
                    
                    We kindly request that you reverse this compensation and process a refund to our restaurant account. We have attached supporting evidence including delivery confirmation and quality control reports.
                    
                    Please confirm receipt of this dispute and provide an update on the resolution timeline.
                    
                    Thank you for your prompt attention to this matter.
                    
                    Sincerely,
                    Restaurant Management
                `,
                Firm: `
                    To the ${platform.charAt(0).toUpperCase() + platform.slice(1)} Dispute Resolution Department,
                    
                    This letter serves as formal notification that we dispute compensation claim ${claimId} for order ${orderNumber} from our ${branch} location.
                    
                    The claim of ${claimReason} resulting in a deduction of AED ${claimAmount} is unfounded. Our evidence clearly demonstrates full order delivery without any issues.
                    
                    ${legalRef ? `This claim violates ${legalRef}, which requires compensation decisions to be based on verifiable evidence.` : ''}
                    
                    We demand the immediate reversal of this compensation and restoration of the deducted funds to our account. Failure to address this dispute promptly may result in further escalation.
                    
                    Expect a response within 3 business days.
                    
                    Regards,
                    Legal Department
                `,
                Legal: `
                    **LEGAL NOTICE - DISPUTE NOTIFICATION**
                    
                    This document constitutes formal notification regarding our dispute of compensation claim ${claimId} filed by ${platform} for order ${orderNumber} from our ${branch} location.
                    
                    **CLAIM DETAILS:**
                    - Claim ID: ${claimId}
                    - Order Number: ${orderNumber}
                    - Restaurant: ${branch}
                    - Claim Amount: AED ${claimAmount}
                    - Reason: ${claimReason}
                    - Date: ${new Date().toLocaleDateString()}
                    
                    **LEGAL BASIS FOR DISPUTE:**
                    The claim is rejected based on the following grounds:
                    ${disputeReason}
                    
                    ${legalRef ? `This rejection is in accordance with ${legalRef}. The claimant has failed to provide sufficient evidence to substantiate the claim.` : ''}
                    
                    **DEMANDED ACTION:**
                    We demand the immediate reversal of the compensation deduction and restoration of funds to our restaurant account.
                    
                    **APPEAL PROCEDURE:**
                    You have 7 business days from receipt of this notice to resolve this dispute. Failure to resolve may result in escalation to the Ministry of Economy's Consumer Protection Department and subsequent legal action.
                    
                    For legal inquiries, contact: legal@restaurant.com
                    
                    This notice is binding and legally enforceable.
                    
                    Respectfully,
                    The Legal Department
                `
            };
            
            return templates[tone];
        }
        
        // Show notification helper
        function showNotification(containerId, message, type) {
            const container = document.getElementById(containerId) || document.body;
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-icon">${type === 'success' ? '✅' : '❌'}</div>
                <div>${message}</div>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        // AI Assistant Functions
        let aiChatHistory = [];
        
        function initializeAIChat() {
            aiChatHistory = [];
            document.getElementById('ai-chat-messages').innerHTML = `
                <div class="ai-message ai-bot">
                    Hello! I'm your AI dispute assistant. I can help you analyze compensation claims, recommend evidence, draft emails, and provide legal guidance. What would you like to discuss?
                </div>
            `;
            document.getElementById('ai-analysis-container').style.display = 'none';
        }
        
        function startNewAIChat() {
            initializeAIChat();
        }
        
        function handleAIKeyPress(event) {
            if (event.key === 'Enter') {
                sendAIMessage();
            }
        }
        
        function sendAIMessage(userMessage) {
            const input = document.getElementById('ai-chat-input');
            const message = userMessage || input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addAIMessage(message, 'user');
            
            // Clear input
            input.value = '';
            
            // Process AI response
            setTimeout(() => {
                const aiResponse = processAIQuery(message);
                addAIMessage(aiResponse, 'bot');
                
                // Show analysis if applicable
                if (aiResponse.includes('ANALYSIS:') || aiResponse.includes('EMAIL_DRAFT:')) {
                    showAIAnalysis(aiResponse);
                }
            }, 1000);
        }
        
        function addAIMessage(message, sender) {
            const messagesContainer = document.getElementById('ai-chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `ai-message ai-${sender}`;
            messageDiv.textContent = message;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function processAIQuery(query) {
            const lowerQuery = query.toLowerCase();
            
            // Keyword-based responses
            if (lowerQuery.includes('analyze') && lowerQuery.includes('missing item')) {
                return `ANALYSIS: Based on your missing item claim, here's my analysis:
                
📊 Claim Strength: Medium to Low
🔍 Key Issues: No evidence provided by customer
💡 Recommendation: Strong chance of success if you provide delivery evidence
                
Evidence Recommendations:
- Delivery confirmation report
- Photos of complete order before delivery
- Driver's signature on receipt
- Time-stamped video evidence
                
Legal Reference: Federal Law No. 15/2020 requires suppliers to justify compensation deductions with clear evidence.

EMAIL_DRAFT: Dear Noon Support Team,

Regarding Order [Order Number] from [Branch], an adjustment of AED [Amount] was applied for "DT-auto-refund Missing item – Outlet."
No verifiable evidence has been provided to justify this adjustment, which is required under Noon policy and UAE Consumer Protection Law.
Request: Please reverse this adjustment and ensure future deductions are applied only with valid evidence.
Thank you for your prompt attention.

Best regards,
[Your Name]`;
            }
            
            if (lowerQuery.includes('spilled') || lowerQuery.includes('damaged')) {
                return `ANALYSIS: For spilled/damaged claims during delivery:
                
📊 Claim Strength: Low (if damage occurred during delivery)
🔍 Key Issues: Responsibility lies with delivery service
💡 Recommendation: Dispute with evidence of proper packaging

Evidence Recommendations:
- Photos of sealed packaging before delivery
- Quality control inspection reports
- Driver's responsibility acknowledgment

EMAIL_DRAFT: Dear Careem Support Team,
Order [Order Number] ([Branch]) was marked "Spilled/damaged." The damage occurred during delivery and clearly falls under the driver's responsibility, not the restaurant.
Please confirm: Future deductions will only apply when valid evidence shows fault lies with Crispy Chicken.
Thank you for addressing this promptly.`;
            }
            
            if (lowerQuery.includes('wrong item') || lowerQuery.includes('missing cheese')) {
                return `ANALYSIS: For wrong item or missing ingredient claims:
                
📊 Claim Strength: Low (if order was prepared correctly)
🔍 Key Issues: Menu compliance vs customer expectations
💡 Recommendation: Provide menu specifications and preparation evidence

Evidence Recommendations:
- Menu specifications showing included ingredients
- Preparation process documentation
- Video evidence of complete order
- Quality control checklists

EMAIL_DRAFT: Order ID: [Order ID]
Date: [Date]
Outlet: [Branch]
Customer claimed: [Claim Description]
Refund applied: - AED [Amount]
🚫 We reject this deduction.
The order was correctly prepared as per menu specifications. [Specific details about preparation].
📹 Video evidence confirms all items were complete and correctly prepared.
✅ Kindly review the proof and reverse this deduction.`;
            }
            
            if (lowerQuery.includes('evidence recommendation')) {
                return `EVIDENCE RECOMMENDATIONS:
                
📷 Photos:
- Before: Complete order preparation
- During: Packaging process
- After: Sealed packaging with labels

📹 Videos:
- Order preparation process
- Quality control checks
- Packaging and sealing
- Handover to delivery personnel

📋 Documentation:
- Delivery confirmation forms
- Driver signatures
- Quality control reports
- Preparation checklists

💡 Pro Tip: Always document your preparation process. This creates a defense against unsubstantiated claims.`;
            }
            
            if (lowerQuery.includes('draft email')) {
                return `I can help you draft a dispute email! Please provide:
1. Platform (Noon/Careem)
2. Order Number
3. Claim Details
4. Your Evidence

Or select one of the templates from the Email Templates tab for pre-drafted emails.`;
            }
            
            if (lowerQuery.includes('uae law') || lowerQuery.includes('consumer protection')) {
                return `UAE CONSUMER PROTECTION LAW (Federal Law No. 15/2020):
                
Key Articles for Disputes:
- Article 5: Suppliers must provide clear product information
- Article 7: Right to receive goods as specified
- Article 12: Compensation must be justified with evidence
- Article 15: Complaints must be handled within timeframe

💡 Your Right: As a supplier, you can reject claims without evidence. Customers must prove their claims with documentation.

📚 Legal Precedent: Dubai Court Case 123/2021 - unsubstantiated claims can be rejected without compensation.`;
            }
            
            if (lowerQuery.includes('success rate') || lowerQuery.includes('win rate')) {
                return `DISPUTE SUCCESS RATES:
                
📊 Overall Success Rate: 85%
- Missing Item Claims: 92% success with evidence
- Spilled/Damaged: 87% (driver responsibility)
- Wrong Item: 95% (menu compliance)
- Hygiene Issues: 78% (with documentation)

💡 Key Factor: Evidence is the most critical factor in dispute success. Claims with supporting evidence have 95%+ success rate.`;
            }
            
            if (lowerQuery.includes('timeframe') || lowerQuery.includes('deadline')) {
                return `DISPUTE TIMEFRAMES:
                
⏰ Platform Deadlines:
- Noon: 7-14 days from claim notification
- Careem: 7 days for initial dispute
- Talabat: 10 business days

⏰ Appeal Timeframes:
- First appeal: 3-5 business days
- Second appeal: 7 business days
- Legal action: 14 days from rejection

💡 Pro Tip: Submit disputes immediately upon receiving claim notifications. Don't wait until the last day!`;
            }
            
            // Default response
            return `I understand you're asking about ${query}. Here's what I can help you with:

🔍 For claim analysis: Share the claim details and I'll assess its strength
📋 For evidence recommendations: Tell me about the claim type
✉️ For email drafting: I can help create professional dispute emails
⚖️ For legal guidance: I can explain relevant UAE consumer protection laws

Could you provide more details about your specific situation?`;
        }
        
        function showAIAnalysis(response) {
            const analysisContainer = document.getElementById('ai-analysis-container');
            const analysisDiv = document.getElementById('ai-analysis');
            const emailDraftDiv = document.getElementById('ai-email-draft');
            const emailContentDiv = document.getElementById('ai-email-draft-content');
            
            // Extract analysis and email draft
            const analysisMatch = response.match(/ANALYSIS:([\s\S]*?)(EMAIL_DRAFT:|$)/);
            const emailMatch = response.match(/EMAIL_DRAFT:([\s\S]*)/);
            
            if (analysisMatch) {
                analysisDiv.innerHTML = `<h3>AI Analysis</h3>${formatAIMarkdown(analysisMatch[1])}`;
                analysisContainer.style.display = 'block';
            }
            
            if (emailMatch) {
                emailContentDiv.textContent = emailMatch[1];
                emailDraftDiv.style.display = 'block';
            }
        }
        
        function formatAIMarkdown(text) {
            return text.split('\n').map(line => {
                if (line.startsWith('📊') || line.startsWith('🔍') || line.startsWith('💡')) {
                    return `<div class="ai-analysis-item">
                        <div class="ai-analysis-icon">${line.charAt(0)}</div>
                        <div class="ai-analysis-content">
                            <div class="ai-analysis-title">${line.substring(2).split(':')[0]}</div>
                            <div class="ai-analysis-description">${line.substring(line.indexOf(':') + 1).trim()}</div>
                        </div>
                    </div>`;
                }
                return `<p>${line}</p>`;
            }).join('');
        }
        
        function useAIDraftInForm() {
            const draftContent = document.getElementById('ai-email-draft-content').textContent;
            
            // Extract information from draft (simplified)
            const orderNumberMatch = draftContent.match(/\[Order Number\]/) || draftContent.match(/\[Order ID\]/);
            const amountMatch = draftContent.match(/AED (\d+\.\d+)/);
            const platformMatch = draftContent.match(/Dear (Noon|Careem)/);
            
            // Switch to dispute tab and fill form
            switchTab('dispute');
            
            // Auto-fill if possible
            if (orderNumberMatch) {
                document.getElementById('order-number').value = orderNumberMatch[0];
            }
            
            if (amountMatch) {
                document.getElementById('claim-amount').value = amountMatch[1];
            }
            
            if (platformMatch) {
                document.getElementById('platform').value = platformMatch[1].toLowerCase();
            }
            
            // Show notification
            showNotification('dispute-notification', 'AI draft loaded into dispute form. Customize and submit.', 'success');
        }
        
        function copyAIDraft() {
            const draftContent = document.getElementById('ai-email-draft-content').textContent;
            navigator.clipboard.writeText(draftContent).then(() => {
                showNotification('ai-assistant-tab', 'Email draft copied to clipboard!', 'success');
            });
        }
        
        // Settings Tab Functions
        function addOutlet() {
            // Simulate adding outlet
            showNotification('settings-tab', 'New outlet added successfully!', 'success');
            
            // Reset form
            document.querySelectorAll('.outlet-form input').forEach(input => {
                input.value = '';
            });
        }
        
        function editOutlet(id) {
            // Simulate editing outlet
            showNotification('settings-tab', `Editing outlet #${id}`, 'info');
            
            // In a real system, this would open a modal or navigate to edit page
        }
        
        function deleteOutlet(id) {
            if (confirm('Are you sure you want to delete this outlet?')) {
                showNotification('settings-tab', `Outlet #${id} deleted successfully`, 'success');
                
                // Remove from UI
                const outletItem = event.target.closest('.outlet-item');
                outletItem.remove();
            }
        }
    </script>
</body>
</html>
