<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Email Tracker — Pro (Local)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root{
    --bg:#f5f7fb;
    --card:#ffffff;
    --primary:#3058d7;
    --primary-600:#274bb8;
    --accent:#00b894;
    --warning:#f6c23e;
    --danger:#f44336;
    --muted:#6b7280;
    --border:#e6e9ef;
    --shadow: 0 6px 18px rgba(16,24,40,0.06);
    --glass: rgba(255,255,255,0.6);
    --radius:12px;
    --transition: all .22s cubic-bezier(.2,.9,.3,1);
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    padding:24px;
    background:linear-gradient(180deg,var(--bg),#eef3fb);
    color:#121212;
    -webkit-font-smoothing:antialiased;
  }

  .container{max-width:1200px;margin:0 auto;}

  header{
    background:linear-gradient(90deg,var(--primary),var(--primary-600));
    color:#fff;padding:20px;border-radius:14px;box-shadow:var(--shadow);margin-bottom:20px;
    display:flex;gap:16px;align-items:center;justify-content:space-between;
  }
  header h1{font-size:1.2rem;margin:0;display:flex;gap:10px;align-items:center}
  header p{margin:0;opacity:.9;font-size:.92rem}

  .grid{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-bottom:20px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);transition:var(--transition)}
  .card .card-title{font-weight:600;margin-bottom:12px;color:#0f1724}

  /* Form */
  .form-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  @media (max-width:680px){.form-grid{grid-template-columns:1fr}}
  .form-control{width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;background:white;font-size:0.95rem}
  .btn{display:inline-flex;gap:8px;align-items:center;border:0;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:600;transition:var(--transition)}
  .btn-primary{background:var(--primary);color:#fff}
  .btn-ghost{background:transparent;border:1px solid var(--border);color:var(--muted)}
  .btn-sm{padding:6px 8px;font-size:.88rem}

  /* Table */
  .table-wrap{overflow:auto;border-radius:10px;border:1px solid var(--border)}
  table{width:100%;border-collapse:collapse;min-width:900px}
  th,td{padding:12px 14px;text-align:left;border-bottom:1px solid var(--border)}
  thead th{background:#fbfdff;position:sticky;top:0;z-index:2}
  tr:hover{background:linear-gradient(90deg,rgba(48,88,215,0.03),transparent)}
  .status-badge{display:inline-block;padding:6px 10px;border-radius:20px;font-weight:600;font-size:.85rem}
  .status-reply{background:#e6f4ea;color:#0f8a3a}
  .status-followup{background:#fff6e6;color:#c67a00}
  .status-closed{background:#fdecea;color:#c62828}
  .priority-badge{margin-left:8px;padding:4px 8px;border-radius:999px;font-weight:600;font-size:.78rem}
  .priority-high{background:#fdecea;color:#b91c1c}
  .priority-medium{background:#fffaf0;color:#92400e}
  .priority-low{background:#eefaf6;color:#087f5b}

  .actions{display:flex;gap:8px;align-items:center}
  .icon-btn{background:transparent;border:1px solid var(--border);padding:8px;border-radius:8px;cursor:pointer}

  /* Dashboard */
  .dashboard-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:14px}
  @media (max-width:980px){.dashboard-grid{grid-template-columns:repeat(2,1fr)}}
  .stat{padding:14px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfdff);box-shadow:var(--shadow);text-align:center}
  .stat .num{font-size:1.6rem;font-weight:700}
  .stat .lbl{color:var(--muted);font-size:.9rem}

  .chart-wrap{height:300px;padding:10px;background:linear-gradient(180deg,#fff,#fbfdff);border-radius:10px;box-shadow:var(--shadow)}

  /* filters */
  .filters{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:8px}
  .filters .filter{min-width:160px}

  /* modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(7,12,20,.45);z-index:1200}
  .modal.show{display:flex}
  .modal-box{background:var(--card);border-radius:12px;padding:18px;max-width:720px;width:100%;box-shadow:0 12px 40px rgba(2,6,23,.35)}
  .modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
  .modal-title{font-weight:700}
  .notes-textarea{width:100%;min-height:140px;padding:10px;border-radius:8px;border:1px solid var(--border);resize:vertical}

  /* toast */
  .toast{position:fixed;right:20px;bottom:20px;min-width:260px;background:#fff;border-radius:10px;padding:12px 14px;box-shadow:var(--shadow);display:flex;gap:12px;align-items:center;transform:translateY(20px);opacity:0;transition:var(--transition);z-index:1300}
  .toast.show{transform:translateY(0);opacity:1}
  .toast.success{border-left:4px solid var(--accent)}
  .toast.info{border-left:4px solid var(--primary)}
  .toast.error{border-left:4px solid var(--danger)}

  small.hint{display:block;color:var(--muted);margin-top:6px;font-size:.85rem}

  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:.9rem}
</style>
</head>
<body dir="rtl">
  <div class="container" role="main">
    <header aria-label="Email Tracker header">
      <div style="display:flex;gap:12px;align-items:center">
        <i class="fa-solid fa-envelope" style="font-size:1.4rem;opacity:.95"></i>
        <h1>نظام متابعة الإيميلات — Pro</h1>
      </div>
      <p>واجهة محلية متقدمة • تخزين دائم محليًا • إشعارات واتساب • داشبورد وتحليلات</p>
    </header>

    <div class="grid">
      <!-- LEFT: FORM + TABLE -->
      <div>
        <div class="card" aria-labelledby="add-email-title">
          <div class="card-title" id="add-email-title">أضف إيميل جديد</div>
          <div class="form-grid" role="form" aria-label="Add new email form">
            <div>
              <label for="subject">الموضوع</label>
              <input id="subject" class="form-control" aria-label="subject" placeholder="Subject ...">
            </div>
            <div>
              <label for="from">المرسل</label>
              <input id="from" class="form-control" type="email" aria-label="from" placeholder="from@example.com">
            </div>
            <div>
              <label for="dateSent">تاريخ الإرسال</label>
              <input id="dateSent" class="form-control" type="datetime-local" aria-label="date sent">
            </div>
            <div>
              <label for="priority">الأولوية</label>
              <select id="priority" class="form-control" aria-label="priority">
                <option value="High">عالي</option>
                <option value="Medium" selected>متوسط</option>
                <option value="Low">منخفض</option>
              </select>
            </div>
            <div style="grid-column:1 / -1">
              <label for="notes">ملاحظات</label>
              <input id="notes" class="form-control" placeholder="ملاحظات قصيرة">
              <small class="hint">املأ الحقول الأساسية: الموضوع، المرسل، والتاريخ.</small>
            </div>
            <div style="display:flex;align-items:end;justify-content:flex-start;grid-column:1 / -1">
              <button class="btn btn-primary" id="addBtn" onclick="addEmail()" aria-label="Add email">
                <i class="fa-solid fa-plus"></i> إضافة الإيميل
              </button>
              <button class="btn btn-ghost btn-sm" onclick="importSample()" style="margin-left:8px">
                <i class="fa-solid fa-download"></i> استيراد مثال
              </button>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
            <div class="card-title">إدارة الإيميلات</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn btn-ghost btn-sm" onclick="exportData()" title="Export JSON"><i class="fa-solid fa-file-export"></i> تصدير</button>
              <button class="btn btn-ghost btn-sm" onclick="clearAll()" title="Clear all"><i class="fa-solid fa-trash"></i> مسح الكل</button>
            </div>
          </div>

          <div class="card" style="padding:12px;margin:0 0 12px 0">
            <div class="filters" role="region" aria-label="filters">
              <div class="filter">
                <label>الحالة</label>
                <select id="statusFilter" class="form-control" onchange="applyFilters()">
                  <option value="">كل الحالات</option>
                  <option value="Reply">Reply</option>
                  <option value="Follow-up">Follow-up</option>
                  <option value="Closed">Closed</option>
                </select>
              </div>
              <div class="filter">
                <label>الأولوية</label>
                <select id="priorityFilter" class="form-control" onchange="applyFilters()">
                  <option value="">كل الأولويات</option>
                  <option value="High">عالي</option>
                  <option value="Medium">متوسط</option>
                  <option value="Low">منخفض</option>
                </select>
              </div>
              <div class="filter" style="min-width:240px">
                <label>بحث</label>
                <input id="searchFilter" class="form-control" placeholder="ابحث في الموضوع، المرسل، أو الملاحظات..." oninput="applyFilters()">
              </div>
              <div style="display:flex;align-items:end">
                <button class="btn btn-ghost btn-sm" onclick="clearFilters()"><i class="fa-solid fa-times"></i> مسح الفلاتر</button>
              </div>
            </div>
          </div>

          <div class="table-wrap" role="table" aria-label="Emails table">
            <table id="emailTable" aria-describedby="emailTableDesc">
              <thead>
                <tr>
                  <th>الموضوع</th>
                  <th>المرسل</th>
                  <th>تاريخ الإرسال</th>
                  <th>الحالة</th>
                  <th>الأولوية</th>
                  <th>ملاحظات</th>
                  <th>إجراءات</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- RIGHT: Dashboard -->
      <aside>
        <div class="card">
          <div class="card-title">الملخص السريع</div>
          <div class="dashboard-grid" aria-hidden="false">
            <div class="stat">
              <div class="num" id="totalNum">0</div>
              <div class="lbl">إجمالي الإيميلات</div>
            </div>
            <div class="stat">
              <div class="num" id="replyNum">0</div>
              <div class="lbl">تم الرد</div>
            </div>
            <div class="stat">
              <div class="num" id="followNum">0</div>
              <div class="lbl">قيد المتابعة</div>
            </div>
            <div class="stat">
              <div class="num" id="closedNum">0</div>
              <div class="lbl">مغلق</div>
            </div>
          </div>
          <div class="chart-wrap" style="margin-top:14px">
            <canvas id="dashChart" aria-label="Status chart" role="img"></canvas>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <div class="card-title">خيارات متقدمة</div>
          <p style="color:var(--muted);margin-bottom:10px">يمكنك ضبط إعدادات الإشعارات أو استيراد البيانات / تصديرها.</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn btn-ghost btn-sm" onclick="setAutoNotify()">تشغيل إشعارات المتأخرات</button>
            <button class="btn btn-ghost btn-sm" onclick="stopAutoNotify()">إيقاف الإشعارات</button>
            <button class="btn btn-ghost btn-sm" onclick="downloadJSON()">تحميل JSON</button>
          </div>
        </div>
      </aside>
    </div>

    <footer>تم الإنشاء لخدمة إدارة الإيميلات — يحفظ محليًا (LocalStorage)</footer>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-box" role="document">
      <div class="modal-header">
        <div class="modal-title">ملاحظات الإيميل</div>
        <button class="icon-btn" aria-label="Close modal" onclick="closeModal()"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="modal-body">
        <label>الموضوع</label>
        <input id="modalSubject" class="form-control" readonly>
        <label style="margin-top:10px">المرسل</label>
        <input id="modalFrom" class="form-control" readonly>
        <label style="margin-top:10px">الملاحظات</label>
        <textarea id="modalNotes" class="notes-textarea" aria-label="email notes"></textarea>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button class="btn btn-primary" onclick="saveModalNotes()">حفظ</button>
        <button class="btn btn-ghost" onclick="closeModal()">إلغاء</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"><i class="fa-solid fa-circle-check" style="color:var(--primary)"></i><div id="toastMsg">تم</div></div>

<script>
/*
  Email Tracker — Pro (local)
  - LocalStorage persistence
  - Modern UI, filters, toast, modal, Chart.js
  - WhatsApp reminders
  - Date formatting
*/

// CONFIG
const STORAGE_KEY = "email_tracker_pro_v1";
const WHATSAPP_NUMBER = "971509021993"; // بدون +
let emails = [];
let filtered = [];
let autoNotifyInterval = null;
let chart = null;

// DEFAULT SAMPLE DATA (only if empty)
const SAMPLE = [
  {Subject:"شكوى تأخير توصيل", From:"customer1@example.com", DateSent:"2025-09-15T10:30", Status:"Follow-up", Priority:"High", Notes:"عاجل: تأخير 30 دقيقة"},
  {Subject:"مشكلة بالفاتورة", From:"finance@example.com", DateSent:"2025-09-16T14:15", Status:"Reply", Priority:"Medium", Notes:"مطلوب تدقيق الفاتورة"},
  {Subject:"اقتراح منتج", From:"customer3@example.com", DateSent:"2025-09-13T09:00", Status:"Follow-up", Priority:"Low", Notes:"اقتراح إضافة وجبة جديدة"}
];

// UTILS
function nowISO(){ return new Date().toISOString().slice(0,16); }
function uid(){ return 'id_' + Math.random().toString(36).slice(2,9); }
function fmt(dateStr){
  if(!dateStr) return "";
  const d = new Date(dateStr);
  if(isNaN(d)) return dateStr;
  return d.toLocaleString('ar-EG', { year:'numeric', month:'short', day:'numeric', hour:'2-digit', minute:'2-digit' });
}
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(emails)); }
function load(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw){ try{ emails = JSON.parse(raw); }catch(e){ emails = [] } }
  if(!emails || !Array.isArray(emails) || emails.length===0){ emails = SAMPLE.map(e => ({...e, id: uid()})); save(); }
  filtered = [...emails];
}

// NOTIFICATIONS (toast)
const toastEl = document.getElementById('toast'), toastMsg = document.getElementById('toastMsg');
function showToast(msg, type='success'){
  toastMsg.textContent = msg;
  toastEl.className = 'toast ' + (type==='success'?'success': type==='info'?'info':'error') + ' show';
  toastEl.querySelector('i').className = type==='success' ? 'fa-solid fa-circle-check' : type==='info' ? 'fa-solid fa-info-circle' : 'fa-solid fa-triangle-exclamation';
  setTimeout(()=>{ toastEl.classList.remove('show'); }, 3000);
}

// RENDER TABLE
function renderTable(){
  const tbody = document.querySelector('#emailTable tbody');
  tbody.innerHTML = '';
  filtered.forEach((e, idx)=>{
    const tr = document.createElement('tr');
    const statusClass = e.Status==='Reply' ? 'status-reply' : e.Status==='Follow-up' ? 'status-followup' : 'status-closed';
    const priorityClass = e.Priority==='High' ? 'priority-high' : e.Priority==='Medium'? 'priority-medium' : 'priority-low';
    tr.innerHTML = `
      <td>${escapeHTML(e.Subject)}</td>
      <td>${escapeHTML(e.From)}</td>
      <td>${fmt(e.DateSent)}</td>
      <td><span class="status-badge ${statusClass}">${e.Status}</span></td>
      <td>${e.Priority} <span class="priority-badge ${priorityClass}">${e.Priority}</span></td>
      <td>${escapeHTML(e.Notes)}</td>
      <td>
        <div class="actions" role="group" aria-label="actions">
          <button class="icon-btn" title="Reply" onclick="setStatus('${e.id}','Reply')"><i class="fa-solid fa-reply"></i></button>
          <button class="icon-btn" title="Follow-up" onclick="setStatus('${e.id}','Follow-up')"><i class="fa-solid fa-sync"></i></button>
          <button class="icon-btn" title="Closed" onclick="setStatus('${e.id}','Closed')"><i class="fa-solid fa-check"></i></button>
          <button class="icon-btn" title="Notes" onclick="openModal('${e.id}')"><i class="fa-solid fa-sticky-note"></i></button>
        </div>
      </td>
    `;
    tbody.appendChild(tr);
  });

  // update sticky aria desc
  document.getElementById('emailTable').setAttribute('aria-rowcount', filtered.length);
}

// CHART & DASHBOARD
function renderDashboard(){
  const totals = {total: emails.length, Reply:0, "Follow-up":0, Closed:0};
  emails.forEach(e => { if(totals[e.Status]!==undefined) totals[e.Status]++; });
  document.getElementById('totalNum').textContent = totals.total;
  document.getElementById('replyNum').textContent = totals.Reply;
  document.getElementById('followNum').textContent = totals["Follow-up"];
  document.getElementById('closedNum').textContent = totals.Closed;

  const ctx = document.getElementById('dashChart').getContext('2d');
  if(chart) chart.destroy();
  chart = new Chart(ctx, {
    type:'doughnut',
    data:{
      labels:['Reply','Follow-up','Closed'],
      datasets:[{
        data:[totals.Reply, totals["Follow-up"], totals.Closed],
        backgroundColor:['#14b8a6','#f59e0b','#ef4444'],
        borderWidth:0
      }]
    },
    options:{plugins:{legend:{position:'bottom'}},responsive:true,maintainAspectRatio:false}
  });
}

// FORM: add email
function addEmail(){
  const subject = document.getElementById('subject').value.trim();
  const from = document.getElementById('from').value.trim();
  const dateSent = document.getElementById('dateSent').value;
  const priority = document.getElementById('priority').value;
  const notes = document.getElementById('notes').value.trim();

  if(!subject || !from || !dateSent){
    showToast('يرجى تعبئة الحقول: الموضوع، المرسل، وتاريخ الإرسال', 'error'); return;
  }

  const item = { id: uid(), Subject: subject, From: from, DateSent: dateSent, Status:'Follow-up', Priority: priority, Notes: notes };
  emails.unshift(item);
  save(); applyFilters(true);
  // reset form
  document.getElementById('subject').value=''; document.getElementById('from').value=''; document.getElementById('dateSent').value=''; document.getElementById('priority').value='Medium'; document.getElementById('notes').value='';
  showToast('تمت إضافة الإيميل', 'success');
}

// Set status (and optionally send whatsapp)
function setStatus(id, status){
  const idx = emails.findIndex(x=>x.id===id);
  if(idx===-1) return;
  emails[idx].Status = status;
  save(); applyFilters();
  showToast('تم تحديث الحالة إلى ' + status, 'success');

  if(status === 'Follow-up'){
    // send whatsapp reminder
    const e = emails[idx];
    const message = `Reminder: "${e.Subject}" from ${e.From} • Status: ${e.Status}`;
    const url = `https://api.whatsapp.com/send?phone=${WHATSAPP_NUMBER}&text=${encodeURIComponent(message)}`;
    window.open(url, '_blank');
    showToast('تم فتح WhatsApp لإرسال التذكير', 'info');
  }
}

// Filters
function applyFilters(skipRender=false){
  const status = document.getElementById('statusFilter').value;
  const priority = document.getElementById('priorityFilter').value;
  const q = document.getElementById('searchFilter').value.trim().toLowerCase();

  filtered = emails.filter(e=>{
    const matchesStatus = !status || e.Status===status;
    const matchesPriority = !priority || e.Priority===priority;
    const matchesQ = !q || (e.Subject + ' ' + e.From + ' ' + e.Notes).toLowerCase().includes(q);
    return matchesStatus && matchesPriority && matchesQ;
  });

  if(!skipRender){ renderTable(); }
}

// Clear filters
function clearFilters(){
  document.getElementById('statusFilter').value=''; document.getElementById('priorityFilter').value=''; document.getElementById('searchFilter').value='';
  filtered = [...emails]; renderTable(); showToast('تم مسح الفلاتر', 'success');
}

// Modal for notes
function openModal(id){
  const item = emails.find(x=>x.id===id);
  if(!item) return;
  document.getElementById('modal').classList.add('show');
  document.getElementById('modal').setAttribute('aria-hidden','false');
  document.getElementById('modalSubject').value = item.Subject;
  document.getElementById('modalFrom').value = item.From;
  document.getElementById('modalNotes').value = item.Notes;
  document.getElementById('modal').dataset.currentId = id;
}
function closeModal(){
  document.getElementById('modal').classList.remove('show');
  document.getElementById('modal').setAttribute('aria-hidden','true');
  delete document.getElementById('modal').dataset.currentId;
}
function saveModalNotes(){
  const id = document.getElementById('modal').dataset.currentId;
  if(!id) return;
  const notes = document.getElementById('modalNotes').value;
  const idx = emails.findIndex(x=>x.id===id);
  if(idx===-1) return;
  emails[idx].Notes = notes;
  save(); applyFilters();
  closeModal(); showToast('تم حفظ الملاحظات', 'success');
}

// Persistence helpers
function exportData(){
  const dataStr = JSON.stringify(emails, null, 2);
  const blob = new Blob([dataStr], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'emails.json'; a.click(); URL.revokeObjectURL(url);
}
function downloadJSON(){ exportData(); showToast('جاري تنزيل ملف JSON', 'info'); }
function clearAll(){
  if(!confirm('هل أنت متأكد؟ سيتم حذف جميع البيانات محليًا')) return;
  emails = []; save(); applyFilters(); renderDashboard(); showToast('تم حذف جميع البيانات', 'success');
}

// import sample
function importSample(){ emails = SAMPLE.map(e=>({...e, id: uid()})); save(); applyFilters(); renderDashboard(); showToast('تم استيراد بيانات تجريبية', 'success'); }

// Auto notify for late emails: > 2 days
function notifyLate(){
  const now = new Date();
  let count = 0;
  emails.forEach(e=>{
    const d = new Date(e.DateSent);
    if(!isNaN(d)){
      const diff = (now - d) / (1000*60*60*24);
      if(diff > 2 && e.Status !== 'Closed'){
        count++;
        const message = `Reminder: "${e.Subject}" from ${e.From} is late (${diff.toFixed(1)} days).`;
        window.open(`https://api.whatsapp.com/send?phone=${WHATSAPP_NUMBER}&text=${encodeURIComponent(message)}`, '_blank');
      }
    }
  });
  if(count>0) showToast(`تم إرسال ${count} تذكير/تذكيرات على WhatsApp`, 'info');
}
function setAutoNotify(){ if(autoNotifyInterval) clearInterval(autoNotifyInterval); autoNotifyInterval = setInterval(notifyLate, 5*60*1000); showToast('تم تفعيل إشعارات المتأخرات', 'success'); }
function stopAutoNotify(){ if(autoNotifyInterval) clearInterval(autoNotifyInterval); autoNotifyInterval = null; showToast('تم إيقاف إشعارات المتأخرات', 'success'); }

// SAFE escape
function escapeHTML(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }

// Init
(function init(){
  load();
  applyFilters(true);
  renderTable();
  renderDashboard();
  // start auto notifications off by default (comment out if you want)
  // setAutoNotify();
})();


// keyboard accessibility: close modal on Esc
document.addEventListener('keydown', (ev)=>{
  if(ev.key==='Escape'){ closeModal(); }
});
</script>
</body>
</html>
